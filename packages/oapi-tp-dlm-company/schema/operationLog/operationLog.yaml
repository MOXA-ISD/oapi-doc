swagger: '2.0'

info:
  version: 0.0.0
  title: DLM Company Portal RESTful API reference
basePath: '/api/v1'
schemes:
  - http
  - https
produces:
  - application/json
tags:
  - name: operationLog
    description: Handles operation logs

paths:
  /operationLogs:
    get:
      description: Return all operation logs
      tags:
        - operationLog
      parameters:
        - name: projectId
          in: path
          description: project unique identifier
          required: true
          type: string
        - name: deviceId
          in: query
          description: device unique identifier
          required: false
          type: string
        - name: userId
          in: query
          description: user unique identifier
          required: false
          type: string
        - name: operation
          in: query
          description: log action
          required: false
          type: string
        - name: level
          in: query
          description: log level
          required: false
          type: string
          enum:
          - emerg
          - alert
          - crit
          - error
          - warning
          - notice
          - info
          - debug
        - name: result
          in: query
          description: operation result
          required: false
          type: string
        - name: order
          in: query
          description: Sort the operation log list by specific condition, default is order by 'createdAt'
          required: false
          type: string
          enum:
          - deviceId
          - userId
          - operation
          - level
          - result
        - name: sort
          in: query
          description: Sorting the filter operation log list, default is desc
          required: false
          type: string
          enum:
          - desc
          - asc
        - name: limit
          in: query
          description: max return operation log count (default is 100 and max is 1000)
          required: false
          type: integer
        - name: offset
          in: query
          description: offset
          required: false
          type: integer
        - name: distinct
          in: query
          description: Get distict value of speific field, this query parameter will return string array only
          required: false
          type: string
          enum:
          - operation
          - level
          - result
      responses:
        200:
          description: An array of the operationLog
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/OperationLog'
              count:
                type: integer
              offset:
                type: integer
              limit:
                type: integer
            example:
              $ref: '#/externalDocs/x-mocks/OperationLogList'
    post:
      description: Create a new operation log.
      tags:
        - project
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/OperationLogCreate'
      responses:
        201:
          description: Create a new operation log successfully
          schema:
            type: object
            items:
              $ref: '#/definitions/OperationLogResult'
            example:
              $ref: '#/externalDocs/x-mocks/OperationLogResult'

definitions:
  OperationLog:
    type: object
    properties:
      id:
        type: integer
        description: Unique identifier representing a specific operation log.
      deviceId:
        type: string
        description: device id.
      userId:
        type: string
        description: user id.
      level:
        type: string
        description: log level.
        enum:
          - emerg
          - alert
          - crit
          - error
          - warning
          - notice
          - info
          - debug
      operation:
        type: string
        description: log action
      result:
        type: string
        description: operation result
      failReason:
        type: string
        description: fail reason
      memo:
        type: string
        description: log memo
      createdAt:
        type: string
        description: operation log created time, ISO data format, like '2018-08-12T20:17:46.384Z'.
  OperationLogCreate:
    type: object
    properties:
      projectId:
        type: string
        description: Unique identifier representing a specific project.
      deviceId:
        type: string
        description: Unique identifier representing a specific device.
      operation:
        type: string
        description: log action
      level:
        type: string
        description: log level - emerg / alert / crit / error / warning / notice / info / debug.
      result:
        type: string
        description: operation result
      failReason:
        type: string
        description: fail reason
      memo:
        type: string
        description: log memo
  OperationLogResult:
    type: object
    properties:
      data:
        type: object
        items:
          $ref: '#/definitions/OperationLog'

externalDocs:
  url: 'http://#'
  x-mocks:
    OperationLog:
      {
        "id": 2011,
        "deviceId": "abc0bd1a-c221-43eb-920d-30f980720ae9",
        "userId": null,
        "level": "info",
        "operation": "offline",
        "result": "success",
        "failReason": "",
        "memo": {},
        "createdAt": "2019-10-16T05:37:55.811Z"
      }
    OperationLogResult:
      {
        "data": {
          "id": 2011,
          "deviceId": "abc0bd1a-c221-43eb-920d-30f980720ae9",
          "userId": null,
          "level": "info",
          "operation": "offline",
          "result": "success",
          "failReason": "",
          "memo": {},
          "createdAt": "2019-10-16T05:37:55.811Z"
        }
      }
    OperationLogList:
      {
        "count": 1,
        "data": [
            {
              "id": 2011,
              "deviceId": "abc0bd1a-c221-43eb-920d-30f980720ae9",
              "userId": null,
              "level": "info",
              "operation": "offline",
              "result": "success",
              "failReason": "",
              "memo": {},
              "createdAt": "2019-10-16T05:37:55.811Z"
            }
        ],
        "limit": 100,
        "offset": 0
      }
